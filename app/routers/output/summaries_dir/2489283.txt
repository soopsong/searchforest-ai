common asset holdings are widely believed to have been the primary vector of contagion in the recent financial crisis . we develop a network approach to the amplification of financial contagion due to the combination of overlapping portfolios and leverage , and we show how it can be understood in terms of a generalized branching process . by studying a stylized model we estimate the circumstances under which systemic instabilities are likely to occur as a function of parameters such as leverage , market crowding , diversification , and market impact . although diversification may be good for individual institutions , it can create dangerous systemic effects , and as a result financial contagion gets worse with too much diversification . under our model there is a critical threshold for leverage ; below it financial networks are always stable , and above it the unstable region grows as leverage increases . the financial system exhibits"robust yet fragile"behavior , with regions of the parameter space where contagion is rare but catastrophic whenever it occurs . our model and methods of analysis can be calibrated to real data and provide simple yet powerful tools for macroprudential stress testing .