quantum key distribution ( qkd ) can be used to generate secret keys between two distant parties . even though qkd has been proven unconditionally secure against eavesdroppers with unlimited computation power , practical implementations of qkd may contain loopholes that may lead to the generated secret keys being compromised . in this paper , we propose a phase - remapping attack targeting two practical bidirectional qkd systems ( the"plug&play"system and the sagnac system ) . we showed that if the users of the systems are unaware of our attack , the final key shared between them can be compromised in some situations . specifically , we showed that , in the case of the bennett - brassard 1984 ( bb84 ) protocol with ideal single - photon sources , when the quantum bit error rate ( qber ) is between 14.6 % and 20 % , our attack renders the final key insecure , whereas the same range of qber values has been proved secure if the two users are unaware of our attack ; also , we demonstrated three situations with realistic devices where positive key rates are obtained without the consideration of trojan horse attacks but in fact no key can be distilled . we remark that our attack is feasible with only current technology . therefore , it is very important to be aware of our attack in order to ensure absolute security . in finding our attack , we minimize the qber over individual measurements described by a general povm , which has some similarity with the standard quantum state discrimination problem .